<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì½˜ì„œíŠ¸í™€ ë¦¬ë²„ë¸Œ íš¨ê³¼ MP3 ì¬ìƒê¸°</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 30px;
            background-color: #f5f5f5;
        }
        input, button {
            font-size: 16px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>ğŸµ ì½˜ì„œíŠ¸í™€ ë¦¬ë²„ë¸Œ íš¨ê³¼ MP3 ì¬ìƒê¸°</h1>
    <input type="file" id="audioFileInput" accept="audio/mp3" />
    <br>
    <button onclick="playWithReverb()">Reverb ì¬ìƒ</button>

    <script>
        let audioContext;
        let audioBuffer;
        let convolverBuffer;

        // ì½˜ì„œíŠ¸í™€ ëŠë‚Œì˜ ì„í„ìŠ¤ ì‘ë‹µ íŒŒì¼ URL (ê³µê°œ ìƒ˜í”Œ)
        const impulseUrl = 'https://cdn.jsdelivr.net/gh/mdn/webaudio-examples/audio-basics/impulse-responses/matrix-reverb2.wav';

        // ì‚¬ìš©ì MP3 íŒŒì¼ ë¡œë”©
        document.getElementById('audioFileInput').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const arrayBuffer = e.target.result;
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                audioContext.decodeAudioData(arrayBuffer, function(buffer) {
                    audioBuffer = buffer;
                    console.log("MP3 íŒŒì¼ ë¡œë“œ ì™„ë£Œ");
                });
            };
            reader.readAsArrayBuffer(file);
        });

        // ë¦¬ë²„ë¸Œìš© ì„í„ìŠ¤ ì‘ë‹µ ë¡œë“œ
        function loadImpulseResponse(callback) {
            fetch(impulseUrl)
                .then(response => response.arrayBuffer())
                .then(arrayBuffer => audioContext.decodeAudioData(arrayBuffer))
                .then(buffer => {
                    convolverBuffer = buffer;
                    console.log("ë¦¬ë²„ë¸Œ ì„í„ìŠ¤ ë¡œë“œ ì™„ë£Œ");
                    if (callback) callback();
                })
                .catch(err => console.error("ì„í„ìŠ¤ ë¡œë“œ ì‹¤íŒ¨:", err));
        }

        // ì¬ìƒ í•¨ìˆ˜
        function playWithReverb() {
            if (!audioBuffer) {
                alert("ë¨¼ì € MP3 íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”.");
                return;
            }

            if (!convolverBuffer) {
                alert("ì„í„ìŠ¤ ì‘ë‹µì´ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
                return;
            }

            const source = audioContext.createBufferSource();
            source.buffer = audioBuffer;

            const convolver = audioContext.createConvolver();
            convolver.buffer = convolverBuffer;

            const gain = audioContext.createGain();
            gain.gain.value = 0.9;

            source.connect(convolver);
            convolver.connect(gain);
            gain.connect(audioContext.destination);

            source.start();
        }

        // ì´ˆê¸°í™”: ì„í„ìŠ¤ ì‘ë‹µ ë¯¸ë¦¬ ë¡œë”©
        window.onload = () => {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            loadImpulseResponse();
        };
    </script>
</body>
</html>
