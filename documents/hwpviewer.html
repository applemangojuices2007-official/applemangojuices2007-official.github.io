<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HWP ë·°ì–´ (hwp.js)</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
    }

    #viewer {
      margin-top: 20px;
      border: 1px solid #ccc;
      padding: 20px;
      white-space: pre-wrap;
      background-color: #f9f9f9;
      min-height: 200px;
    }

    input[type="file"], input[type="text"], button {
      font-size: 16px;
      margin: 5px 0;
    }

    #dropZone {
      border: 2px dashed #999;
      padding: 40px;
      text-align: center;
      color: #666;
      margin-top: 20px;
      background-color: #f0f0f0;
      transition: background-color 0.3s;
    }

    #dropZone.dragover {
      background-color: #e0e0e0;
    }
  </style>
</head>
<body>

  <h1>ğŸ“„ HWP íŒŒì¼ ë·°ì–´</h1>

  <h3>1. íŒŒì¼ ì—…ë¡œë“œ</h3>
  <input type="file" id="hwpInput" accept=".hwp" />

  <h3>2. ë“œë˜ê·¸ ì•¤ ë“œë¡­</h3>
  <div id="dropZone">ì—¬ê¸°ë¡œ HWP íŒŒì¼ì„ ë“œë˜ê·¸ ì•¤ ë“œë¡­í•˜ì„¸ìš”</div>

  <h3>3. ì˜¨ë¼ì¸ HWP íŒŒì¼ URL</h3>
  <input type="text" id="urlInput" placeholder="https://example.com/sample.hwp" style="width: 100%;" />
  <button id="loadUrlBtn">URLì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°</button>

  <div id="viewer">ì—¬ê¸°ì— ë¬¸ì„œ ë‚´ìš©ì´ í‘œì‹œë©ë‹ˆë‹¤.</div>

  <!-- hwp.js ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ -->
  <script src="https://cdn.jsdelivr.net/npm/hwp.js/dist/hwp.min.js"></script>
  <script>
    const input = document.getElementById('hwpInput');
    const dropZone = document.getElementById('dropZone');
    const urlInput = document.getElementById('urlInput');
    const loadUrlBtn = document.getElementById('loadUrlBtn');
    const viewer = document.getElementById('viewer');

    // ê³µí†µ ì²˜ë¦¬ í•¨ìˆ˜
    async function handleArrayBuffer(arrayBuffer) {
      try {
        const hwpDocument = await HWP.read(arrayBuffer);
        const html = HWP.toHTML(hwpDocument);
        viewer.innerHTML = html;
      } catch (err) {
        viewer.innerHTML = `<p style="color:red;">âš ï¸ ì˜¤ë¥˜: HWP íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>`;
        console.error(err);
      }
    }

    // íŒŒì¼ ì„ íƒ
    input.addEventListener('change', async (event) => {
      const file = event.target.files[0];
      if (file) {
        const arrayBuffer = await file.arrayBuffer();
        handleArrayBuffer(arrayBuffer);
      }
    });

    // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì²˜ë¦¬
    dropZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      dropZone.classList.add('dragover');
    });

    dropZone.addEventListener('dragleave', () => {
      dropZone.classList.remove('dragover');
    });

    dropZone.addEventListener('drop', async (e) => {
      e.preventDefault();
      dropZone.classList.remove('dragover');
      const file = e.dataTransfer.files[0];
      if (file && file.name.endsWith('.hwp')) {
        const arrayBuffer = await file.arrayBuffer();
        handleArrayBuffer(arrayBuffer);
      } else {
        viewer.innerHTML = `<p style="color:red;">âš ï¸ HWP íŒŒì¼ë§Œ ì§€ì›ë©ë‹ˆë‹¤.</p>`;
      }
    });

    // URLì—ì„œ íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°
    loadUrlBtn.addEventListener('click', async () => {
      const url = urlInput.value.trim();
      if (!url) return alert('URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      try {
        const response = await fetch(url);
        if (!response.ok) throw new Error('íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        const arrayBuffer = await response.arrayBuffer();
        handleArrayBuffer(arrayBuffer);
      } catch (err) {
        viewer.innerHTML = `<p style="color:red;">âš ï¸ ì˜¤ë¥˜: URLì—ì„œ íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>`;
        console.error(err);
      }
    });
  </script>

</body>
</html>
